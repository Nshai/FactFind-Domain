SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

-- ========================================================================================
-- Description: Stored procedure for getting Client Vulnerabilities by list of CRMContactId
-- ========================================================================================
CREATE PROCEDURE [dbo].[SpListClientVulnerabilityLightQuery] 
    @CRMContactIds NVARCHAR(MAX)
AS
BEGIN
   DECLARE @ClientIds TABLE ([ClientId] INT);
   INSERT INTO @ClientIds SELECT CAST(value AS INT) from STRING_SPLIT(@CRMContactIds,',')

   SELECT
     [CRMContactId]
	,[HasVulnerability]
   FROM
	 [crm]..[TClientVulnerability]
   JOIN 
	 @ClientIds ON [ClientId] = [CRMContactId]
   WHERE 
     [IsCurrent] = 1
   ORDER BY
     [CRMContactId]
END
GO